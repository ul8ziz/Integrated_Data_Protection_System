# دليل سيناريو الاختبار - نظام حماية البيانات
# Test Scenario Guide - Data Protection System

## نظرة عامة

هذا السيناريو يختبر نظام حماية البيانات في بيئة جهازين:
- **الجهاز 1 (السيرفر الرئيسي)**: يستضيف النظام ويبث الإنترنت
- **الجهاز 2 (العميل)**: يرسل إيميلات أو يفحص بيانات

عند اكتشاف بيانات حساسة، يتم تطبيق السياسات تلقائياً (منع، تحذير، تشفير).

## ملاحظة مهمة: الاستخدام العادي

**المستخدمون العاديون لا يحتاجون أي ملفات أو تثبيت:**
- يحتاجون فقط **متصفح ويب** (Chrome, Firefox, Edge, Safari)
- الاتصال بالشبكة
- معرفة IP السيرفر
- فتح `http://SERVER_IP:8000` في المتصفح
- تسجيل الدخول مباشرة من الواجهة

**سكريبت الاختبار Python:**
- اختياري - للاختبار فقط
- يحتاج Python و requests library
- ليس مطلوباً للاستخدام العادي

## المتطلبات

### على الجهاز 1 (السيرفر):

1. **تشغيل النظام:**
   ```bash
   # Windows
   start.bat
   
   # Linux/Mac
   ./start.sh
   
   # PowerShell
   .\start.ps1
   ```

2. **التأكد من أن السيرفر يستمع على جميع الواجهات:**
   - السيرفر يعمل على `0.0.0.0:8000` (يستمع على جميع الواجهات)
   - يمكن الوصول إليه من أجهزة أخرى على نفس الشبكة

3. **معرفة IP السيرفر:**
   ```bash
   # Windows
   ipconfig
   
   # Linux/Mac
   ifconfig
   # أو
   ip addr
   ```
   
   ابحث عن IP الخاص بك على الشبكة (مثال: `192.168.1.100`)

4. **التأكد من الجدار الناري:**
   - السماح بالاتصالات الواردة على المنفذ 8000
   - Windows: إضافة استثناء في Windows Firewall
   - Linux: فتح المنفذ باستخدام `ufw` أو `iptables`

### على الجهاز 2 (العميل):

**الاستخدام العادي (متصفح ويب):**
- لا يحتاج أي تثبيت
- فقط متصفح ويب

**الاختبار (سكريبت Python - اختياري):**
1. تثبيت Python 3.8+:
   ```bash
   # التحقق من تثبيت Python
   python --version
   ```

2. تثبيت المكتبات المطلوبة:
   ```bash
   pip install requests
   # أو
   pip install -r backend/test_requirements.txt
   ```

## خطوات الاستخدام

### الاستخدام العادي (متصفح ويب)

1. **على الجهاز 1 (السيرفر):**
   - تشغيل السيرفر باستخدام `start.bat` أو `start.sh` أو `start.ps1`
   - معرفة IP السيرفر (مثال: `192.168.1.100`)

2. **على الجهاز 2 (العميل):**
   - فتح المتصفح
   - زيارة `http://192.168.1.100:8000` (استبدل IP السيرفر الفعلي)
   - تسجيل الدخول من الواجهة
   - استخدام جميع الميزات:
     - فحص نص للبيانات الحساسة
     - فحص ملفات
     - إرسال إيميلات للفحص (من تبويب Monitoring)
     - عرض التحذيرات
     - إدارة السياسات (للمسؤولين)

### الاختبار (سكريبت Python - اختياري)

1. **تعديل إعدادات السيرفر:**
   
   افتح `backend/test_scenario_client.py` وعدّل:
   ```python
   SERVER_URL = "http://192.168.1.100:8000"  # IP السيرفر الرئيسي
   ```

2. **تسجيل الدخول (اختياري):**
   ```python
   USERNAME = "admin"  # أو اسم المستخدم
   PASSWORD = "your_password"  # كلمة المرور
   ```

3. **تشغيل السيناريو:**
   ```bash
   cd backend
   python test_scenario_client.py
   ```

## السيناريوهات المختبرة

### السيناريو 1: إرسال إيميل يحتوي على بيانات حساسة
- يرسل إيميل يحتوي على: رقم هاتف، بريد إلكتروني، بطاقة ائتمان، عنوان
- **النتيجة المتوقعة**: يتم اكتشاف البيانات، تطبيق السياسات، منع الإيميل، إنشاء تحذير

### السيناريو 2: فحص نص يحتوي على بيانات حساسة
- يفحص نص يحتوي على: اسم، SSN، هاتف، بريد إلكتروني
- **النتيجة المتوقعة**: يتم اكتشاف البيانات، تطبيق السياسات، إنشاء تحذير

### السيناريو 3: إرسال إيميل بدون بيانات حساسة
- يرسل إيميل عادي بدون بيانات حساسة
- **النتيجة المتوقعة**: يتم السماح بالإيميل، لا يتم إنشاء تحذيرات

### السيناريو 4: فحص نص يحتوي على سكريبت خبيث
- يفحص نص يحتوي على: JavaScript، SQL injection، eval
- **النتيجة المتوقعة**: يتم اكتشاف السكريبت الخبيث، تطبيق السياسات

## التحقق من النتائج

### على السيرفر (الجهاز 1):

1. **فحص التحذيرات:**
   - افتح الواجهة: `http://SERVER_IP:8000`
   - انتقل إلى تبويب "Alerts"
   - تحقق من التحذيرات الجديدة

2. **فحص السجلات:**
   - انتقل إلى تبويب "Monitoring"
   - تحقق من السجلات الجديدة

3. **فحص الإحصائيات:**
   ```bash
   curl http://SERVER_IP:8000/api/monitoring/email/statistics
   ```

### على العميل (الجهاز 2):

**الاستخدام العادي:**
- عرض التحذيرات في الواجهة
- عرض نتائج الفحص مباشرة

**الاختبار (سكريبت Python):**
- يتم طباعة النتائج في Terminal/Console
- يمكن فحص التحذيرات باستخدام `check_alerts()`

## استكشاف الأخطاء

### المشكلة: لا يمكن الاتصال بالسيرفر

**الأعراض:**
- لا يمكن فتح `http://SERVER_IP:8000` في المتصفح
- رسالة خطأ "Connection refused" أو "Timeout"

**الحلول:**
1. تأكد من أن السيرفر يعمل على الجهاز 1
2. تأكد من IP السيرفر الصحيح
3. تأكد من أن الجهازين على نفس الشبكة
4. تأكد من أن الجدار الناري يسمح بالاتصال على المنفذ 8000
5. جرب الاتصال من الجهاز 1 نفسه: `http://127.0.0.1:8000`

### المشكلة: خطأ 401 Unauthorized

**الأعراض:**
- رسالة "Unauthorized" عند محاولة الوصول

**الحلول:**
1. قم بتسجيل الدخول أولاً من الواجهة
2. للاختبار باستخدام Python:
   ```python
   USERNAME = "admin"
   PASSWORD = "your_password"
   ```

### المشكلة: لا يتم اكتشاف البيانات

**الأعراض:**
- لا يتم اكتشاف البيانات الحساسة في النص

**الحلول:**
1. تأكد من وجود سياسات نشطة في النظام
2. تأكد من أن السياسات تشمل أنواع الكيانات المكتشفة
3. تحقق من أن النص يحتوي فعلاً على بيانات حساسة (أرقام هواتف، بريد إلكتروني، إلخ)

### المشكلة: لا يتم تطبيق السياسات

**الأعراض:**
- يتم اكتشاف البيانات لكن لا يتم تطبيق أي إجراء

**الحلول:**
1. تأكد من وجود سياسات نشطة (`enabled: true`)
2. تأكد من أن السياسات تشمل أنواع الكيانات المكتشفة
3. تحقق من أن السياسات غير محذوفة (`is_deleted: false`)

## أمثلة إضافية

### إرسال إيميل مخصص:
```python
tester = DataProtectionTester("http://192.168.1.100:8000")
tester.send_email(
    from_email="user@example.com",
    to_emails=["recipient@example.com"],
    subject="Test Email",
    body="Your phone is 123-456-7890"
)
```

### فحص ملف:
```python
tester.analyze_file(
    file_path="document.txt",
    source_user="test_user"
)
```

### فحص نص مخصص:
```python
tester.analyze_text(
    text="My credit card is 4532-1234-5678-9010",
    source_user="test_user"
)
```

### فحص التحذيرات:
```python
alerts = tester.check_alerts(limit=20)
for alert in alerts:
    print(f"Alert: {alert['title']}")
```

## ملاحظات الأمان

- السيرفر يعمل على `0.0.0.0` مما يعني أنه يستمع على جميع الواجهات
- في الإنتاج، يجب استخدام HTTPS
- يجب تقييد الوصول باستخدام الجدار الناري
- يجب استخدام authentication للوصول إلى APIs الحساسة
- يجب تغيير كلمات المرور الافتراضية

## الدعم

إذا واجهت أي مشاكل:
1. تحقق من السجلات في `backend/logs/app.log`
2. تحقق من حالة النظام في `/api/monitoring/status`
3. تأكد من أن MongoDB يعمل بشكل صحيح
4. تأكد من أن جميع المتطلبات مثبتة

## الخلاصة

هذا السيناريو يوضح كيفية استخدام نظام حماية البيانات في بيئة جهازين:
- **الاستخدام العادي**: يحتاج فقط متصفح ويب
- **الاختبار**: يمكن استخدام سكريبت Python (اختياري)

النظام يعمل بشكل كامل من خلال الواجهة الأمامية، ولا يحتاج المستخدمون العاديون أي تثبيت أو ملفات.
